<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>COGS 118B: Yelp Dataset</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/styles/default.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.17.0/vis.min.css">
    <link rel="stylesheet" href="style/dracula.css">
    <link rel="stylesheet" href="style/animate.css">
    <link rel="stylesheet" href="style/styles.css">
    <link rel="icon" type="image/png" href="assets/favicon.png">
    

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <img src="assets/yelp_logo.png" class="floating-logo"/>
    <div class="row wow fadeInUp">
      <h1>COGS 118B: Yelp Dataset</h1>
    </div>
    <div class="row wow fadeInUp">
      <div class="col-lg-6 col-md-6">
        <div class="card">
          <div id="chart"></div>
          <h3>3D Surface Plot of Linear Planar Fit</h3>
          <div class="card-caption">
            <i>
            f(x,y) = 3.688 + -0.00003891x + 0.0003306y<br />
            where x = number of check-ins and y = number of reviews
            </i>
          </div>
        </div>
      </div>
      <div class="col-lg-6 col-md-6">
         <div class="card">
           <!-- <div class="chart"></div> -->
           <h3>Put Chart2 here</h3>
           <div class="card-caption">
            <p>chart captioned</p>
          </div>
        </div>
      </div>
    </div>
    
    <div class="row wow fadeInUp">
    <h2>Technical Walkthrough</h2>
    <div class="col-lg-4 col-md-12">
      <div class="card process">
          <h3>1. Obtain Relevant Data</h3>
          <div class="card-caption">
            <p>To download the Yelp Dataset you first have to register to join their dataset challenge on their site linked <a href="https://www.yelp.com/dataset_challenge">here.</a> This allows you to choose from the businesses, check-ins, users, tips, and photos datasources, each of which is stored in JSON format. For this project we needed to obtain the businesses and check-ins files to get the amount of checkins associated with each businesses throughout the times provided, and correlate that to the business rating and review count that is specified in the businesses file.</p>
          </div>
        </div>
    </div>
    
    <div class="col-lg-8 col-md-12">
      <div class="card process">
          <h3>2. Check-ins Data Format</h3>
          <div class="card-caption">
          <div class="row">
          <div class="col-lg-4 col-md-4">
          <p>From this sample provided by Yelp, what we can see is that the check-ins file provides a daily breakdown at hourly time intervals to show the checkins that occured throughout the week on each day and time in the entire businesses history of being on Yelp. Out of this information what we en dup being most concerned in is the encypted business id (business_id) which allows us to uniquely identify a business and the sum total of all the checkins that occur throughout the history of the business which can be pulled from the array representing the breakdown of all check-in information (checkin_info).</p>
          </div>
          <div class="col-lg-8 col-md-8">
          <pre><code>
{
  'type': 'checkin',
  'business_id': (encrypted business id),
  'checkin_info': {
      '0-0': (number of checkins from 00:00 to 01:00 on all Sundays),
      '1-0': (number of checkins from 01:00 to 02:00 on all Sundays),
      ...
      '14-4': (number of checkins from 14:00 to 15:00 on all Thursdays),
      ...
      '23-6': (number of checkins from 23:00 to 00:00 on all Saturdays)
  }, # if there was no checkin for a hour-day block it will not be in the dict
}
          </code></pre>
          </div>
          </div>  
          </div>
        </div>
    </div>
    </div>
    <div class="row wow fadeInUp">
    <div class="col-lg-8 col-md-8">
      <div class="card process">
          <h3>3. Businesses Data Format</h3>
          <div class="card-caption">
          <div class="row">
          <div class="col-lg-8 col-md-8">
            <pre><code>
{
  'type': 'business',
  'business_id': (encrypted business id),
  'name': (business name),
  'neighborhoods': [(hood names)],
  'full_address': (localized address),
  'city': (city),
  'state': (state),
  'latitude': latitude,
  'longitude': longitude,
  'stars': (star rating, rounded to half-stars),
  'review_count': review count,
  'categories': [(localized category names)]
  'open': True / False (corresponds to closed, not business hours),
  'hours': {
      (day_of_week): {
          'open': (HH:MM),
          'close': (HH:MM)
      },
      ...
  },
  'attributes': {
      (attribute_name): (attribute_value),
      ...
  },
}
            </code></pre>
            </div>
            <div class="col-lg-4 col-md-4">
                <p>From this sample provided by Yelp, what we can see is that the businesses file provides basic information like the type of business its name, neighborhood, address, city, state, etc. But for our project the main concern was the encrypted business id (business_id), the city (city), the business ratings (stars), and the amount of reviews provided for the restaurant (review_count). From this information we can get identify a business in a specific city that we have chosen to represent either a large metropolitan area or smaller suburban township, and map that to the number of check-ins that have been logged, as well as provide the corresponding rating and review count totals.</p>
            </div>
            </div>
          </div>
        </div>
    </div>
    <div class="col-lg-4 col-md-4">
      <div class="card process">
          <h3>4. Parsing the Data (Conceptual)</h3>
          <div class="card-caption">
            <p>Conceptually what we want to do is first parse through all of the check-in data provided by Yelp, and for each business get the total amount of check-ins that occur throughout the entire history of the business, and then finally map them to the business id in the object format {business_id: total_checkins}. From there we can parse through the businesses data and at each value map the business id provided to the newly parsed check-ins file to get total check-ins and create an object for each business in the format {business_id: [rating, review_count, total_checkins]}. This process can also be modified to only include certain cities by only choosing to log businesses that have a matching 'city' parameter in their object definition. Now that we have a JSON object that represents all important data for us it has to be brought into a useable MATLAB format to run K-means clustering algorithms on for analysis. This is achieved using the JSONlab plugin for MATLAB that converts the JSON sting into a structure format representing all the data. Finally this structure has to be parsed one at a time and account for null data entries (when there are no recorded check-ins) and then create a usable a matrix format of just relevant data.</p>
          </div>
      </div>
    </div>
    </div>
    <div class="row wow fadeInUp">
      <div class = "col-lg-4 col-md-4">
         <div class="card process">
          <h3>5. Parsing the Check-ins</h3>
          <div class="card-caption">
            <pre><code>
/*Create a usable data format of {businessid: total checkins}*/
var fs = require('fs');

var checkIns = {};
var checkInRaw = fs.readFileSync('../data/yelp_academic_dataset_checkin.json', 'utf8').toString().split("\n");
for (var j = 0; j < checkInRaw.length -1; j++){
  checkInRaw[j] = JSON.parse(checkInRaw[j]);
  var totalCheckIns = 0;
  var keys = Object.keys(checkInRaw[j].checkin_info);
  var businessKey = checkInRaw[j].business_id;
  for(var i = 0; i < keys.length; i++){
    totalCheckIns += checkInRaw[j].checkin_info[keys[i]];
  }
  checkIns[businessKey] = totalCheckIns;
}

fs.writeFile('../data/yelp_checkins.json', JSON.stringify(checkIns, null, 2), function(err){
  if(err){
    return console.log(err);
  }
});
            </code></pre>
          </div>
      </div>
      </div>
      <div class = "col-lg-4 col-md-4">
         <div class="card process">
          <h3>6. Parsing the Businesses</h3>
          <div class="card-caption">
            <pre><code>
/*Create a usable data format of {businessid: [rating, review count, checkin count]}*/
var fs = require('fs');

var businesses = {};
var businessesRaw = fs.readFileSync('../data/yelp_academic_dataset_business.json', 'utf8').toString().split("\n");
var checkins = JSON.parse(fs.readFileSync('../data/yelp_checkins.json', 'utf8'));
for (var j = 0; j < businessesRaw.length - 1; j++){
  businessesRaw[j] = JSON.parse(businessesRaw[j]);
  businesses[businessesRaw[j].business_id] = [businessesRaw[j].stars, businessesRaw[j].review_count, checkins[businessesRaw[j].business_id]];
}

fs.writeFile('../data/yelp_businesses_all.json', JSON.stringify(businesses, null, 2), function(err){
  if(err){
    return console.log(err);
  }
});
            </code></pre>
            <p>Data split by cities script <a href="https://github.com/sdsharma/yelp-machine-learning/blob/master/js/parse-businesses.js">here</a>.</p>
          </div>
      </div>
      </div>
      <div class = "col-lg-4 col-md-4">
         <div class="card process">
          <h3>7. Parsing the JSON</h3>
          <div class="card-caption">
            <pre><code>
function return_mat = RemoveNulls(input)
  result_cells = struct2cell(input(1,1));
  return_mat = [];
  for i=1:length(result_cells)
    try
      cell = cell2mat(result_cells(i));
    catch
      result_cells{i,1}{3} = 0;
      cell = cell2mat(result_cells{i});
    end
    return_mat = [return_mat; cell];
  end
end
            </code></pre>
          </div>
      </div>
      </div>
    </div>

    <div class="row wow fadeInUp">
    <div class="col-lg-4 col-md-4">
        <div class="card process">
        <h3>8. Target Clustering for Population Density Comparison</h3>
          <div class="card-caption">
            <p>One thing that we wanted to explore was how different population densities would affect the results in our clustering. To analyze this futher we sifted through our data to see large concentrations of businesses in certain cities that we could define as being large metropolitan areas, and areas a lower but still large enough data space to analyze as what we can define as a suburban area (~50-100 businesses). </p>
          </div>
        </div>
      </div>
      <div class="col-md-8 col-lg-8">
      <div class = "card process">
      <h3>9. Cities Chosen for Target Clustering</h3>
      <div class="card-caption" style = "text-align: left;">
      <div class="row">
      <div class="col-md-6 col-lg-6">
        <h5>Large Cities/Metropolitan Areas</h5>
        <h6>Las Vegas, Nevada</h6>
        <ul>
        <li>Population: 603,488</li>
        <li>Number of Businesses: 19,328</li>
        </ul>
        <h6>Phoenix, Arizona</h6>
        <ul>
        <li>Population: 1,513,000</li>
        <li>Number of Businesses: 11,852</li>
        </ul>
        <h6>Charlotte, North Carolina</h6>
        <ul>
        <li>Population: 789,862</li>
        <li>Number of Businesses: 5,695</li>
        </ul>
      </div>
      <div class="col-md-6 col-lg-6">
        <h5>Small Cities/Suburban Areas</h5>
        <h6>Carnegie, Pennsylvania</h6>
        <ul>
        <li>Population: 7,947</li>
        <li>Number of Businesses: 62</li>
        </ul>
        <h6>San Tan Valley, Arizona</h6>
        <ul>
        <li>Population: 81,231</li>
        <li>Number of Businesses: 100</li>
        </ul>
        <h6>Belmont, North Carolina</h6>
        <ul>
        <li>Population: 10,412</li>
        <li>Number of Businesses: 83</li>
        </ul>
      </div>
        </div>
        
      </div>
      </div>
      
      </div>

    </div>
    
    <!-- Including Bootstrap JS (with its jQuery dependency) so that dynamic components work -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.17.0/vis.min.js"></script>
    <script src="js/wow.min.js"></script>
    <script src="js/app.js"></script>
  </body>
</html>
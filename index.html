<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Yelp Dataset Prediction Model</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/styles/default.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.17.0/vis.min.css">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Oswald" />
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Lato" />
    <link rel="stylesheet" href="style/dracula.css">
    <link rel="stylesheet" href="style/ekko-lightbox.min.css">
    <link rel="stylesheet" href="style/animate.css">
    <link rel="stylesheet" href="style/styles.css">
    <link rel="icon" type="image/png" href="assets/favicon.png">
    
    <script src="js/angular.min.js"></script>
    <script src="js/RatingCalculator/RatingCalculator.js"></script>
    

    <!-- HTML5 Shiv and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="title-nav">
      <h1>Yelp Dataset Prediction Model</h1>
    </div>
    <img src="assets/yelp_logo.png" class="floating-logo"/>
    <div style="height: 90px;">
    </div>
    <div class="row wow fadeInUp">
      <div class="col-lg-6 col-md-6">
        <div class="card">
          <div id="chart"></div>
          <h3>3D Surface Plot of Linear Planar Fit</h3>
          <div class="card-caption">
            <p style="font-style: italic;">
            f(x,y) = 3.688 + -0.00003891x + 0.0003306y<br />
            where x = number of check-ins and y = number of reviews
            </p>
          </div>
        </div>
      </div>
      <div class="col-lg-6 col-md-6">
         <div class="card">
           <!-- <div class="chart"></div> -->
           <h3>Put Chart2 here</h3>
           <div class="card-caption">
            <p>chart captioned</p>
          </div>
        </div>
      </div>
      <div class="col-lg-6 col-md-6">
        <div class="card">
          <!-- <div class="chart"></div> -->
          <h3>Calculator</h3>
          <div ng-app="ratingCalculator" class="card-caption">
            <rating-calculator></rating-calculator>
          </div>
        </div>
      </div>
    </div>

    <div class="row wow fadeInUp">
    </div>
    
    <div class="row wow fadeInUp">
    <h2>Technical Walkthrough</h2>
    <div class="col-lg-4 col-md-12">
      <div class="card process">
          <h3>1. Obtain Relevant Data</h3>
          <div class="card-caption">
            <p>To download the Yelp Dataset you first have to register to join their dataset challenge on their site linked <a href="https://www.yelp.com/dataset_challenge">here.</a> This allows you to choose from the businesses, check-ins, users, tips, and photos datasources, each of which is stored in JSON format. For this project we needed to obtain the businesses and check-ins files to get the amount of checkins associated with each businesses throughout the times provided, and correlate that to the business rating and review count that is specified in the businesses file.</p>
          </div>
        </div>
    </div>
    
    <div class="col-lg-8 col-md-12">
      <div class="card process">
          <h3>2. Check-ins Data Format</h3>
          <div class="card-caption">
          <div class="row">
          <div class="col-lg-4 col-md-4">
          <p>From this sample provided by Yelp, what we can see is that the check-ins file provides a daily breakdown at hourly time intervals to show the checkins that occured throughout the week on each day and time in the entire businesses history of being on Yelp. Out of this information what we en dup being most concerned in is the encypted business id (business_id) which allows us to uniquely identify a business and the sum total of all the checkins that occur throughout the history of the business which can be pulled from the array representing the breakdown of all check-in information (checkin_info).</p>
          </div>
          <div class="col-lg-8 col-md-8">
          <pre><code>{
  'type': 'checkin',
  'business_id': (encrypted business id),
  'checkin_info': {
      '0-0': (number of checkins from 00:00 to 01:00 on all Sundays),
      '1-0': (number of checkins from 01:00 to 02:00 on all Sundays),
      ...
      '14-4': (number of checkins from 14:00 to 15:00 on all Thursdays),
      ...
      '23-6': (number of checkins from 23:00 to 00:00 on all Saturdays)
  }, # if there was no checkin for a hour-day block it will not be in the dict
}</code></pre>
          </div>
          </div>  
          </div>
        </div>
    </div>
    </div>
    <div class="row wow fadeInUp">
    <div class="col-lg-8 col-md-8">
      <div class="card process">
          <h3>3. Businesses Data Format</h3>
          <div class="card-caption">
          <div class="row">
          <div class="col-lg-8 col-md-8">
            <pre><code>{
  'type': 'business',
  'business_id': (encrypted business id),
  'name': (business name),
  'neighborhoods': [(hood names)],
  'full_address': (localized address),
  'city': (city),
  'state': (state),
  'latitude': latitude,
  'longitude': longitude,
  'stars': (star rating, rounded to half-stars),
  'review_count': review count,
  'categories': [(localized category names)]
  'open': True / False (corresponds to closed, not business hours),
  'hours': {
      (day_of_week): {
          'open': (HH:MM),
          'close': (HH:MM)
      },
      ...
  },
  'attributes': {
      (attribute_name): (attribute_value),
      ...
  },
}</code></pre>
            </div>
            <div class="col-lg-4 col-md-4">
                <p>From this sample provided by Yelp, what we can see is that the businesses file provides basic information like the type of business its name, neighborhood, address, city, state, etc. But for our project the main concern was the encrypted business id (business_id), the city (city), the business ratings (stars), and the amount of reviews provided for the restaurant (review_count). From this information we can get identify a business in a specific city that we have chosen to represent either a large metropolitan area or smaller suburban township, and map that to the number of check-ins that have been logged, as well as provide the corresponding rating and review count totals.</p>
            </div>
            </div>
          </div>
        </div>
    </div>
    <div class="col-lg-4 col-md-4">
      <div class="card process">
          <h3>4. Parsing the Data (Conceptual)</h3>
          <div class="card-caption">
            <p>Conceptually what we want to do is first parse through all of the check-in data provided by Yelp, and for each business get the total amount of check-ins that occur throughout the entire history of the business, and then finally map them to the business id in the object format {business_id: total_checkins}. From there we can parse through the businesses data and at each value map the business id provided to the newly parsed check-ins file to get total check-ins and create an object for each business in the format {business_id: [rating, review_count, total_checkins]}. This process can also be modified to only include certain cities by only choosing to log businesses that have a matching 'city' parameter in their object definition. Now that we have a JSON object that represents all important data for us it has to be brought into a useable MATLAB format to run K-means clustering algorithms on for analysis. This is achieved using the JSONlab plugin for MATLAB that converts the JSON sting into a structure format representing all the data. Finally this structure has to be parsed one at a time and account for null data entries (when there are no recorded check-ins) and then create a usable a matrix format of just relevant data.</p>
          </div>
      </div>
    </div>
    </div>
    <div class="row wow fadeInUp">
      <div class = "col-lg-4 col-md-4">
         <div class="card process">
          <h3>5. Parsing the Check-ins</h3>
          <div class="card-caption">
            <pre><code>/*Create a usable data format of {businessid: total checkins}*/
var fs = require('fs');

var checkIns = {};
var checkInRaw = fs.readFileSync('../data/yelp_academic_dataset_checkin.json', 'utf8').toString().split("\n");
for (var j = 0; j < checkInRaw.length -1; j++){
  checkInRaw[j] = JSON.parse(checkInRaw[j]);
  var totalCheckIns = 0;
  var keys = Object.keys(checkInRaw[j].checkin_info);
  var businessKey = checkInRaw[j].business_id;
  for(var i = 0; i < keys.length; i++){
    totalCheckIns += checkInRaw[j].checkin_info[keys[i]];
  }
  checkIns[businessKey] = totalCheckIns;
}

fs.writeFile('../data/yelp_checkins.json', JSON.stringify(checkIns, null, 2), function(err){
  if(err){
    return console.log(err);
  }
});</code></pre>
          </div>
      </div>
      </div>
      <div class = "col-lg-4 col-md-4">
         <div class="card process">
          <h3>6. Parsing the Businesses</h3>
          <div class="card-caption">
            <pre><code>/*Create a usable data format of {businessid: [rating, review count, checkin count]}*/
var fs = require('fs');

var businesses = {};
var businessesRaw = fs.readFileSync('../data/yelp_academic_dataset_business.json', 'utf8').toString().split("\n");
var checkins = JSON.parse(fs.readFileSync('../data/yelp_checkins.json', 'utf8'));
for (var j = 0; j < businessesRaw.length - 1; j++){
  businessesRaw[j] = JSON.parse(businessesRaw[j]);
  businesses[businessesRaw[j].business_id] = [businessesRaw[j].stars, businessesRaw[j].review_count, checkins[businessesRaw[j].business_id]];
}

fs.writeFile('../data/yelp_businesses_all.json', JSON.stringify(businesses, null, 2), function(err){
  if(err){
    return console.log(err);
  }
});</code></pre>
            <p>Data split by cities script <a href="https://github.com/sdsharma/yelp-machine-learning/blob/master/js/parse-businesses.js">here</a>.</p>
          </div>
      </div>
      </div>
      <div class = "col-lg-4 col-md-4">
         <div class="card process">
          <h3>7. Parsing the JSON</h3>
          <div class="card-caption">
            <pre><code>function return_mat = RemoveNulls(input)
  result_cells = struct2cell(input(1,1));
  return_mat = [];
  for i=1:length(result_cells)
    try
      cell = cell2mat(result_cells(i));
    catch
      result_cells{i,1}{3} = 0;
      cell = cell2mat(result_cells{i});
    end
    return_mat = [return_mat; cell];
  end
end</code></pre>
          </div>
      </div>
      <br />
      <div class="card process">
        <h3>8. Target Clustering for Population Density Comparison</h3>
          <div class="card-caption">
            <p>One thing that we wanted to explore was how different population densities would affect the results in our clustering. To analyze this futher we sifted through our data to see large concentrations of businesses in certain cities that we could define as being large metropolitan areas, and areas a lower but still large enough data space to analyze as what we can define as a suburban area (~50-100 businesses). </p>
          </div>
        </div>
      </div>
    </div>

    <div class="row wow fadeInUp">
    
      <div class="col-md-8 col-lg-8">
      <div class = "card process">
      <h3>9. Cities Chosen for Target Clustering</h3>
      <div class="card-caption" style = "text-align: left;">
      <div class="row">
      <div class="col-md-6 col-lg-6">
        <h5>Large Cities/Metropolitan Areas</h5>
        <h6>Las Vegas, Nevada</h6>
        <ul>
        <li>Population: 603,488</li>
        <li>Number of Businesses: 19,328</li>
        </ul>
        <h6>Phoenix, Arizona</h6>
        <ul>
        <li>Population: 1,513,000</li>
        <li>Number of Businesses: 11,852</li>
        </ul>
        <h6>Charlotte, North Carolina</h6>
        <ul>
        <li>Population: 789,862</li>
        <li>Number of Businesses: 5,695</li>
        </ul>
      </div>
      <div class="col-md-6 col-lg-6">
        <h5>Small Cities/Suburban Areas</h5>
        <h6>Carnegie, Pennsylvania</h6>
        <ul>
        <li>Population: 7,947</li>
        <li>Number of Businesses: 62</li>
        </ul>
        <h6>San Tan Valley, Arizona</h6>
        <ul>
        <li>Population: 81,231</li>
        <li>Number of Businesses: 100</li>
        </ul>
        <h6>Belmont, North Carolina</h6>
        <ul>
        <li>Population: 10,412</li>
        <li>Number of Businesses: 83</li>
        </ul>
      </div>
        </div>
        
      </div>
      </div>
      
      </div>

      <div class="col-lg-4 col-md-4">
        <div class="card process">
        <h3>10. Plotting Our Data</h3>
          <div class="card-caption">
            <p>Once we aggregated all of our data, we ran the K-means algorithm to determine any cluster trends across specific permutations of paired data sets. We determined this through what seemed to be most likely to give an obvious trend through observations of the paired sets. The data is displayed as follows for the overall aggregate.</p>
          </div>
        </div>
      </div>

    </div>

    <div class="row wow fadeInUp">
    <h2>Full Dataset K-Means</h2>
    <div class="col-lg-4 col-md-4">
        <div class="card process">
          <a href="assets/k-means/Rating%20vs%20%23%20of%20Reviews.png" data-toggle="lightbox">
          <img src = "assets/k-means/Rating%20vs%20%23%20of%20Reviews.png" style="width:100%;" />
          </a>
          <div class="card-caption">
            <h6>K-Means Plot of the ratings of each of the business versus the number of reviews for the entire dataset.</h6>
            <p style="font-style: italic;">
            1st cluster - 3.8602, 968.0172, K = 2<br />
            2nd cluster - 3.6937 27.9724, K = 23
            </p>
            <p>For the first cluster of data there seems to be a slight increase in the average rating, given a large amount of user reviews. This seems to signify that a higher volume of user ratings may typically imply popularity, which could influence users to give higher ratings. However it is possible that this change could just be due to random variation, but given the large sample size of the entire data set, it can be safe to say that this slight change is relatively accurate without completely resampling the data set.</p>
          </div>
        </div>
      </div>
    <div class="col-lg-4 col-md-4">
        <div class="card process">
        <a href="assets/k-means/Rating%20vs%20%23%20of%20Checkins.png" data-toggle="lightbox">
        <img src = "assets/k-means/Rating%20vs%20%23%20of%20Checkins.png" style="width:100%;" />
        </a>
          <div class="card-caption">
            <h6>K-Means Plot of the ratings of each of the business versus the number of checkins for the entire dataset.</h6>
            <p style="font-style: italic;">
            1st cluster - 3.6618, 13,304, K = 2<br />
            2nd cluster - 3.6949 98.7103, K = 28
            </p>
            <p>For the second cluster of data we found that rating and the number of Check-ins have no significant impact on each other. Both data clusters gave a similar rating average despite the second cluster having a significant amount of check-ins per business.It can definately be said that one can conclude nothing from the clustering due to the apparent lack of variation among the data fields.</p>
          </div>
        </div>
      </div>
      <div class="col-lg-4 col-md-4">
        <div class="card process">
        <a href="assets/k-means/Num%20of%20Reviews%20vs%20%23%20of%20Checkins.png" data-toggle="lightbox">
        <img src = "assets/k-means/Num%20of%20Reviews%20vs%20%23%20of%20Checkins.png" style="width:100%;" />
        </a>
          <div class="card-caption">
            <h6>K-Means Plot of the number of reviews versus the number of checkins for the entire dataset.</h6>
            <p style="font-style: italic;">
            1st cluster - 1,940.7, 13,303, K = 2<br />
            2nd cluster - 32.8421, 98.7113, K = 30
            </p>
            <p>For the third data set it can be seen from the first cluster that a large amount of reviews result in significantly large amounts of check-ins and from the second cluster a small amount of reviews result in smaller amounts of check ins. This can be easily explained as typically popular business are promoted to incentivize their customers to check-in for some added benefit. Another aspect that this clustering uncovers is the disparity between popular and unpopular businesses, that the difference is vast enough to be extremely polarizing.</p>
          </div>
        </div>
      </div>
      
      
    </div>

    <div class="row wow fadeInUp">
    <h2>Suburban Areas</h2>
      <div class="col-lg-4 col-md-4">
        <div class="card process">
        <a href="assets/plots/belmont%20-%20review%20vs%20%23%20of%20checkins.png" data-toggle="lightbox">
        <img src = "assets/plots/belmont%20-%20review%20vs%20%23%20of%20checkins.png" style="width:100%;" />
        </a>
          <div class="card-caption">
            <p>Plot of the ratings of each of the business versus the number of checkins for Belmont, North Carolina.</p>
          </div>
        </div>
      </div>
      <div class="col-lg-4 col-md-4">
        <div class="card process">
          <a href="assets/plots/belmont%20-%20review%20vs%20%23%20of%20reviews.png" data-toggle="lightbox">
          <img src = "assets/plots/belmont%20-%20review%20vs%20%23%20of%20reviews.png" style="width:100%;" />
          </a>
          <div class="card-caption">
            <p>Plot of the ratings of each of the business versus the number of reviews for Belmont, North Carolina.</p>
          </div>
        </div>
      </div>
      <div class="col-lg-4 col-md-4">
        <div class="card process">
          <a href="assets/plots/carnegie%20-%20review%20vs%20%23%20of%20checkins.png" data-toggle="lightbox">
          <img src = "assets/plots/carnegie%20-%20review%20vs%20%23%20of%20checkins.png" style="width:100%;" />
          </a>
          <div class="card-caption">
            <p>Plot of the ratings of each of the business versus the number of checkins for Carnegie, Pennsylvania.</p>
          </div>
        </div>
      </div>
    </div>

    <div class="row wow fadeInUp">
      <div class="col-lg-4 col-md-4">
        <div class="card process">
        <a href="assets/plots/carnegie%20-%20review%20vs%20%23%20of%20reviews.png" data-toggle="lightbox">
        <img src = "assets/plots/carnegie%20-%20review%20vs%20%23%20of%20reviews.png" style="width:100%;" />
        </a>
          <div class="card-caption">
            <p>Plot of the ratings of each of the business versus the number of reviews for Carnegie, Pennsylvania.</p>
          </div>
        </div>
      </div>
      <div class="col-lg-4 col-md-4">
        <div class="card process">
          <a href="assets/plots/santanvalley%20-%20review%20vs%20%23%20of%20checkins.png" data-toggle="lightbox">
          <img src = "assets/plots/santanvalley%20-%20review%20vs%20%23%20of%20checkins.png" style="width:100%;" />
          </a>
          <div class="card-caption">
            <p>Plot of the ratings of each of the business versus the number of checkins for San Tan Valley, Arizona.</p>
          </div>
        </div>
      </div>
      <div class="col-lg-4 col-md-4">
        <div class="card process">
          <a href="assets/plots/santanvalley%20-%20review%20vs%20%23%20of%20reviews.png" data-toggle="lightbox">
          <img src = "assets/plots/santanvalley%20-%20review%20vs%20%23%20of%20reviews.png" style="width:100%;" />
          </a>
          <div class="card-caption">
            <p>Plot of the ratings of each of the business versus the number of reviews for San Tan Valley, Arizona.</p>
          </div>
        </div>
      </div>
    </div>

    <div class="row wow fadeInUp">
    <h2>Metropolitan Areas</h2>
      <div class="col-lg-4 col-md-4">
        <div class="card process">
        <a href="assets/plots/charlotte%20-%20review%20vs%20%23%20of%20checkins.png" data-toggle="lightbox">
        <img src = "assets/plots/charlotte%20-%20review%20vs%20%23%20of%20checkins.png" style="width:100%;" />
        </a>
          <div class="card-caption">
            <p>Plot of the ratings of each of the business versus the number of checkins for Charlotte, North Carolina.</p>
          </div>
        </div>
      </div>
      <div class="col-lg-4 col-md-4">
        <div class="card process">
          <a href="assets/plots/charlotte%20-%20review%20vs%20%23%20of%20reviews.png" data-toggle="lightbox">
          <img src = "assets/plots/charlotte%20-%20review%20vs%20%23%20of%20reviews.png" style="width:100%;" />
          </a>
          <div class="card-caption">
            <p>Plot of the ratings of each of the business versus the number of reviews for Charlotte, North Carolina.</p>
          </div>
        </div>
      </div>
      <div class="col-lg-4 col-md-4">
        <div class="card process">
          <a href="assets/plots/phoenix%20-%20review%20vs%20%23%20of%20checkins.png" data-toggle="lightbox">
          <img src = "assets/plots/phoenix%20-%20review%20vs%20%23%20of%20checkins.png" style="width:100%;" />
          </a>
          <div class="card-caption">
            <p>Plot of the ratings of each of the business versus the number of checkins for Phoenix, Arizona.</p>
          </div>
        </div>
      </div>
    </div>

    <div class="row wow fadeInUp">
      <div class="col-lg-4 col-md-4">
        <div class="card process">
        <a href="assets/plots/phoenix%20-%20review%20vs%20%23%20of%20reviews.png" data-toggle="lightbox">
        <img src = "assets/plots/phoenix%20-%20review%20vs%20%23%20of%20reviews.png" style="width:100%;" />
        </a>
          <div class="card-caption">
            <p>Plot of the ratings of each of the business versus the number of reviews for Phoenix, Arizona.</p>
          </div>
        </div>
      </div>
      <div class="col-lg-4 col-md-4">
        <div class="card process">
          <a href="assets/plots/vegas%20-%20review%20vs%20%23%20of%20checkins.png" data-toggle="lightbox">
          <img src = "assets/plots/vegas%20-%20review%20vs%20%23%20of%20checkins.png" style="width:100%;" />
          </a>
          <div class="card-caption">
            <p>Plot of the ratings of each of the business versus the number of checkins for Las Vegas, Nevada.</p>
          </div>
        </div>
      </div>
      <div class="col-lg-4 col-md-4">
        <div class="card process">
          <a href="assets/plots/vegas%20-%20review%20vs%20%23%20of%20reviews.png" data-toggle="lightbox">
          <img src = "assets/plots/vegas%20-%20review%20vs%20%23%20of%20reviews.png" style="width:100%;" />
          </a>
          <div class="card-caption">
            <p>Plot of the ratings of each of the business versus the number of reviews for Las Vegas, Nevada.</p>
          </div>
        </div>
      </div>
    </div>
    
    <div class="row wow fadeInUp">
      <h2>Curve Fitting on Dataset</h2>
      <div class="col-lg-12 col-md-12">
         <div class="card process">
          <a href="assets/plots/3DcurveFit.png" data-toggle="lightbox">
          <img src = "assets/plots/3DcurveFit.png" style="width:100%;" />
          </a>
          <div class="card-caption">
            <p>Fitting a linear plane equation to the entire dataset to find a rating based on the input of review count and checkin count.</p>
          </div>
        </div>
      </div>
    </div>

    <div class="row wow fadeInUp">
      <div class="col-lg-12 col-md-12">
         <div class="card process">
         <h3>Project Postmortem</h3>
          <div class="card-caption">
            <p>Throughout our project we experienced several problems in conducting our algorithms. Our first problem was that though the Yelp data set was supposed to be in a JSON format, the actual contents of the data set were not formatted correctly placing extra work on us to parse through the data into a readable MATLAB format. Our solution to fix this problem was to use three separate parsing algorithms, one for parsing through associated business id’s and check-ins along with the check-in data, another for parsing through associated business id’s and reviews and ratings, and another for associating the business id’s with all of the other variables. This was an extremely difficult challenge for us to overcome, as the data was additionally formatted horribly. For example, Las Vegas had eight different identifiers(Las Vegas, las vegas, las Vegas, NV) which made it difficult to condense into one identifier given the other set of difficulties we had in the JSON file. Our second problem that we encountered was us dealing with buggy MATLAB builds that made our code not work despite it being syntactically correct. We had to restart MATLAB to resolve this. We found that our original data sub-sections did not display any obvious trends, so we decided to combine all of categories to find overall patterns in the biggest possible scope. This meant combining all city data into one large aggregate. We also tried to plot the data over 3 dimensions, but the result was nothing of significant value.</p>
          </div>
        </div>
      </div>
    </div>
    <!-- Including Bootstrap JS (with its jQuery dependency) so that dynamic components work -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.17.0/vis.min.js"></script>
    <script src="js/ekko-lightbox.min.js"></script>
    <script src="js/wow.min.js"></script>
    <script src="js/app.js"></script>
  </body>
</html>